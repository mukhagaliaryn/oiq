{% extends './layout.html' %}

{% block title %}Соңғылары{% endblock title %}

{% block game_tasks_layout %}
    {% if game_tasks %}
        <div class="space-y-4">
            <div class="flex gap-4 justify-between items-center">
                <div class="relative max-w-xs w-full">
                    <input 
                        type="text"
                        placeholder="Іздеу..."
                        class="w-full pl-9 pr-4 py-2 rounded-xl border border-border-200 focus:ring-2 focus:ring-primary-600"    
                    >
                    <svg 
                        xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round" 
                        class="lucide lucide-search-icon lucide-search absolute top-2.5 start-2.5 text-muted">
                        <path d="m21 21-4.34-4.34" />
                        <circle cx="11" cy="11" r="8" />
                    </svg>
                </div>

                <div class="flex items-start gap-1">
                    <button class="flex p-2 rounded-xl cursor-pointer transition-all text-muted hover:bg-primary-50 active:scale-95 focus:ring-2 focus:ring-primary-600">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-grid2x2-icon lucide-grid-2x2">
                            <path d="M12 3v18" />
                            <path d="M3 12h18" />
                            <rect x="3" y="3" width="18" height="18" rx="2" />
                        </svg>
                    </button>

                    <button class="flex p-2 rounded-xl cursor-pointer transition-all text-muted hover:bg-primary-50 active:scale-95 focus:ring-2 focus:ring-primary-600">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="lucide lucide-layout-list-icon lucide-layout-list">
                            <rect width="7" height="7" x="3" y="3" rx="1" />
                            <rect width="7" height="7" x="3" y="14" rx="1" />
                            <path d="M14 4h7" />
                            <path d="M14 9h7" />
                            <path d="M14 15h7" />
                            <path d="M14 20h7" />
                        </svg>
                    </button>
                </div>
            </div>

            <div class="grid">
                {% for item in game_tasks %}
                    <div 
                        x-data="{ open: false, confirmDelete: false }" 
                        id="gt-{{ item.id }}" 
                        class="relative"
                    >
                        <a 
                            href="{% url 'dashboard:game_task_detail' item.pk %}"
                            class="flex justify-between items-center gap-4 p-2 border-b border-border-200 transition-all group"
                        >
                            <div class="aspect-square rounded-xl p-2 flex justify-center items-center bg-primary-50">
                                <lord-icon
                                    src="https://cdn.lordicon.com/xzvgfwwv.json"
                                    trigger="hover"
                                    colors="primary:#ebe6ef,secondary:#4f46e5"
                                    style="width: 48px; height: 48px;">
                                </lord-icon>
                            </div>

                            <div class="flex-1 grid gap-1">
                                <h4 class="font-bold">{{ item.name }}</h4>
                                <div class="flex">
                                    <div class="px-2 py-1 text-xs rounded-xl border border-border-200 text-muted">
                                        <span>{{ item.activity.get_activity_type_display }}: </span>
                                        <span>{{ item.activity.name }}</span>
                                    </div>
                                </div>
                            </div>

                            <button
                                x-on:click.prevent="open = !open"
                                type="button"
                                class="hidden p-2 rounded-xl cursor-pointer transition-all text-muted group-hover:flex hover:bg-primary-50 active:scale-95 focus:flex focus:ring-2 focus:ring-primary-600"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-ellipsis-icon lucide-ellipsis">
                                    <circle cx="12" cy="12" r="1" />
                                    <circle cx="19" cy="12" r="1" />
                                    <circle cx="5" cy="12" r="1" />
                                </svg>
                            </button>
                        </a>

                        <!-- Әрекеттер -->
                        <div
                            x-show="open"
                            x-transition
                            x-on:click.outside="open = false"
                            class="absolute top-16 right-0 w-40 bg-white border border-border-200 rounded-xl shadow-xs z-30"
                        >
                            <ul class="p-2">
                                <li>
                                    <a 
                                        href="{% url 'dashboard:game_task_edit' pk=item.pk %}"
                                        class="flex w-full px-4 py-2 rounded-xl cursor-pointer text-subtle hover:bg-secondary-100"
                                    >
                                        Өзгерту
                                    </a>
                                </li>
                                <li>
                                    <button 
                                        @click.prevent="open = false; confirmDelete = true"
                                        class="flex w-full px-4 py-2 rounded-xl cursor-pointer text-destructive hover:bg-red-100"
                                    >
                                        Жою
                                    </button>
                                </li>
                            </ul>
                        </div>

                        <!-- Жоюды растау -->
                        <div
                            x-show="confirmDelete"
                            x-transition.opacity
                            x-cloak
                            class="fixed inset-0 z-50 flex items-center justify-center bg-black/50"
                            @keydown.escape.window="confirmDelete = false"
                        >
                            <div class="grid gap-4 bg-white rounded-2xl shadow-lg w-full max-w-md p-6">
                                <div class="space-y-2">
                                    <h3 class="font-black text-xl line-clamp-1">Жоюды растау</h3>
                                    <p class="text-muted">
                                        Шынымен жойғыңыз келе ме? Бұл әрекет қайтарылмайды.
                                    </p>
                                </div>
                                <div class="flex justify-end gap-2">
                                    <button
                                        type="button"
                                        @click="confirmDelete = false"
                                        class="flex px-4 py-2 font-medium rounded-xl border border-border-200 hover:bg-secondary-100 cursor-pointer"
                                    >
                                        Болдырмау
                                    </button>
                                    <form
                                        hx-post="{% url 'dashboard:game_task_delete' item.id %}"
                                        method="post"
                                        hx-on::after-request="
                                            document.getElementById('gt-{{ item.id }}').remove();
                                            showFlash('Ойын тапсырмасы өшірілді!', 'success');
                                        "
                                        hx-swap="none"
                                    >
                                        {% csrf_token %}
                                        <button
                                            type="submit"
                                            class="flex px-4 py-2 font-medium rounded-xl bg-red-600 text-white hover:bg-red-700 cursor-pointer"
                                        >
                                            Иә, жою
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% else %}
        <div class="flex justify-center">
            <div class="grid gap-2 py-16">
                <lord-icon
                    src="https://cdn.lordicon.com/ikagbcik.json"
                    trigger="in"
                    colors="primary:#f5f5f5,secondary:#d4d4d4"
                    style="width:128px; height:128px"
                    class="mx-auto"    
                >
                </lord-icon>
                <span class="text-muted">Әлі ойын тапсырмасы жасалмаған</span>
            </div>
        </div>
    {% endif %}
{% endblock game_tasks_layout %}