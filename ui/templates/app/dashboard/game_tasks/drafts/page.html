{% extends '../layout.html' %}

{% block title %}Аяқталмағандар{% endblock title %}

{% block game_tasks_layout %}
    {% if game_tasks %}
        <div class="grid">
            {% for item in game_tasks %}
                <div x-data="{ open: false, confirmDelete: false }" id="gt-{{ item.id }}"  class="relative">
                    <a
                        href="{% url 'dashboard:game_task_edit' item.pk %}"
                        class="flex justify-between items-center gap-4 p-2 border-b border-border-200 transition-all group"
                    >
                        <div class="aspect-square rounded-xl p-2 flex justify-center items-center bg-primary-50">
                            <lord-icon
                                src="https://cdn.lordicon.com/xzvgfwwv.json"
                                trigger="hover"
                                colors="primary:#ebe6ef,secondary:#4f46e5"
                                style="width: 48px; height: 48px;">
                            </lord-icon>
                        </div>

                        <div class="flex-1 grid gap-1">
                            <h4 class="font-bold">#{{ item.id }}-ойын тапсырмасы</h4>
                            <div class="flex">
                                <div class="px-2 py-1 text-xs rounded-xl bg-amber-500 text-white">
                                    <span>{{ item.get_status_display }}</span>
                                </div>
                            </div>
                        </div>

                        <button
                            x-on:click.prevent="open = !open"
                            type="button"
                            class="hidden p-2 rounded-xl cursor-pointer transition-all text-muted group-hover:flex hover:bg-primary-50 active:scale-95 focus:flex focus:ring-2 focus:ring-primary-600"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-ellipsis-icon lucide-ellipsis">
                                <circle cx="12" cy="12" r="1" />
                                <circle cx="19" cy="12" r="1" />
                                <circle cx="5" cy="12" r="1" />
                            </svg>
                        </button>
                    </a>

                    <!-- Әрекеттер -->
                    <div
                        x-show="open"
                        x-transition
                        x-on:click.outside="open = false"
                        class="absolute top-16 right-0 w-40 bg-white border border-border-200 rounded-xl shadow-xs z-30"
                    >
                        <ul class="p-2">
                            <li>
                                <a 
                                    href="{% url 'dashboard:game_task_edit' pk=item.pk %}"
                                    class="flex w-full px-4 py-2 rounded-xl cursor-pointer text-subtle hover:bg-secondary-100"
                                >
                                    Жалғастыру
                                </a>
                            </li>
                            <li>
                                <button 
                                    @click.prevent="open = false; confirmDelete = true"
                                    class="flex w-full px-4 py-2 rounded-xl cursor-pointer text-destructive hover:bg-red-100"
                                >
                                    Жою
                                </a>
                            </li>
                        </ul>
                    </div>

                    <!-- Жоюды растау -->
                    <div
                        x-show="confirmDelete"
                        x-transition.opacity
                        x-cloak
                        class="fixed inset-0 z-50 flex items-center justify-center bg-black/50"
                        @keydown.escape.window="confirmDelete = false"
                    >
                        <div class="grid gap-4 bg-white rounded-2xl shadow-lg w-full max-w-md p-6">
                            <div class="space-y-2">
                                <h3 class="font-black text-xl line-clamp-1">Жоюды растау</h3>
                                <p class="text-muted">
                                    Шынымен жойғыңыз келе ме? Бұл әрекет қайтарылмайды.
                                </p>
                            </div>
                            
                            <div class="flex justify-end gap-2">
                                <button
                                    type="button"
                                    @click="confirmDelete = false"
                                    class="flex px-4 py-2 font-medium rounded-xl border border-border-200 hover:bg-secondary-100 cursor-pointer"
                                >
                                    Болдырмау
                                </button>
                                <form
                                    hx-post="{% url 'dashboard:game_task_delete' item.id %}"
                                    method="post"
                                    hx-on::after-request="
                                        document.getElementById('gt-{{ item.id }}').remove();
                                        showFlash('Ойын тапсырмасы өшірілді!', 'success');
                                    "
                                    hx-swap="none"
                                >
                                    {% csrf_token %}
                                    <button
                                        type="submit"
                                        class="flex px-4 py-2 font-medium rounded-xl bg-red-600 text-white hover:bg-red-700 cursor-pointer"
                                    >
                                        Иә, жою
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="flex justify-center">
            <div class="grid gap-2 py-16">
                <lord-icon
                    src="https://cdn.lordicon.com/ikagbcik.json"
                    trigger="in"
                    colors="primary:#f5f5f5,secondary:#d4d4d4"
                    style="width:128px; height:128px"
                    class="mx-auto"    
                >
                </lord-icon>
                <span class="text-muted">Әлі ойын тапсырмасы жасалмаған</span>
            </div>
        </div>
    {% endif %}
{% endblock game_tasks_layout %}