<div class="space-y-8">
    <!-- –ñ–∞–ª–ø—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="flex justify-center">
        <div class="grid grid-cols-3 gap-4">
            <div class="flex gap-2 items-center rounded-2xl border border-border-200 bg-white p-6">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users-icon lucide-users">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
                    <path d="M16 3.128a4 4 0 0 1 0 7.744" />
                    <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
                    <circle cx="9" cy="7" r="4" />
                </svg>
                <div class="grid items-start">
                    <span class="text-xs text-muted">“ö–∞—Ç—ã—Å—É—à—ã–ª–∞—Ä</span>
                    <span class="text-4xl font-bold">
                        {{ session.participants.count }}
                    </span>
                </div>
            </div>

            <div class="flex gap-2 items-center rounded-2xl border border-border-200 bg-white p-6">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-goal-icon lucide-goal">
                    <path d="M12 13V2l8 4-8 4" />
                    <path d="M20.561 10.222a9 9 0 1 1-12.55-5.29" />
                    <path d="M8.002 9.997a5 5 0 1 0 8.9 2.02" />
                </svg>
                <div class="grid items-start">
                    <span class="text-xs text-muted">–ê—è“õ—Ç–∞“ì–∞–Ω–¥–∞—Ä</span>
                    <span class="text-4xl font-bold">
                        {{ finished_count }}
                        <span class="text-muted">
                        / {{ session.participants.count }}
                        </span>
                    </span>
                </div>
            </div>

            <div class="flex gap-2 items-center rounded-2xl border border-border-200 bg-white p-6">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" class="text-amber-500" viewBox="0 0 24 24" fill="currentColor">
                    <path 
                        fill-rule="evenodd"
                        d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.006 5.404.434c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.434 2.082-5.005Z"
                        clip-rule="evenodd" 
                    />
                </svg>
                <div class="grid items-start">
                    <span class="text-xs text-muted">–û—Ä—Ç–∞—à–∞ “±–ø–∞–π</span>
                    <span class="text-4xl font-bold">
                        {{ avg_score|default:"-" }}
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- –ê–ª“ì–∞—à“õ—ã “Ø—à—Ç—ñ–∫ -->
    {% with top3=participants|slice:":3" %}
        {% if top3 %}
            <div class="w-full max-w-4xl mx-auto space-y-4">
                <h2 class="text-xl md:text-2xl font-black text-center">–ê–ª“ì–∞—à“õ—ã “Ø—à—Ç—ñ–∫</h2>
                <div class="grid gap-4 grid-cols-1 sm:grid-cols-3">
                    <!-- 1-–æ—Ä—ã–Ω. –û—Ä—Ç–∞–¥–∞ -->
                    <div class="sm:order-2 space-y-2 border border-border-200 rounded-xl text-center p-8">
                        <div class="
                            w-24 h-24 mx-auto flex justify-center items-center rounded-full border-4 border-primary-300 bg-primary-600 
                            text-white text-4xl font-black
                        ">
                            {{ top3.0.nickname|first|upper }}
                        </div>
                        <div class="space-y-2">
                            <h2 class="text-xl md:text-2xl font-black">{{ top3.0.nickname }}</h2>
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" class="mx-auto text-amber-500" viewBox="0 0 24 24" fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M5.166 2.621v.858c-1.035.148-2.059.33-3.071.543a.75.75 0 0 0-.584.859 6.753 6.753 0 0 0 6.138 5.6 6.73 6.73 0 0 0 2.743 1.346A6.707 6.707 0 0 1 9.279 15H8.54c-1.036 0-1.875.84-1.875 1.875V19.5h-.75a2.25 2.25 0 0 0-2.25 2.25c0 .414.336.75.75.75h15a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-2.25-2.25h-.75v-2.625c0-1.036-.84-1.875-1.875-1.875h-.739a6.706 6.706 0 0 1-1.112-3.173 6.73 6.73 0 0 0 2.743-1.347 6.753 6.753 0 0 0 6.139-5.6.75.75 0 0 0-.585-.858 47.077 47.077 0 0 0-3.07-.543V2.62a.75.75 0 0 0-.658-.744 49.22 49.22 0 0 0-6.093-.377c-2.063 0-4.096.128-6.093.377a.75.75 0 0 0-.657.744Zm0 2.629c0 1.196.312 2.32.857 3.294–ê5.266 5.266 0 0 1 3.16 5.337..."
                                    clip-rule="evenodd" />
                            </svg>
                            <span class="font-bold text-amber-500">
                                {{ top3.0.score }} “±–ø–∞–π ¬∑ {{ top3.0.correct_count }} –¥“±—Ä—ã—Å
                            </span>
                        </div>
                    </div>

                    <!-- 2-–æ—Ä—ã–Ω. –°–æ–ª –∂–∞“õ -->
                    <div class="sm:order-1 h-full space-y-2 border border-border-200 rounded-xl text-center p-8 translate-y-4">
                        {% if top3|length > 1 %}
                            <div class="
                                w-20 h-20 mx-auto flex justify-center items-center rounded-full border-4 border-primary-100 bg-primary-50 
                                text-primary-700 text-3xl font-black
                            ">
                                {{ top3.1.nickname|first|upper }}
                            </div>
                            <div class="space-y-2">
                                <h2 class="text-lg md:text-xl font-black">{{ top3.1.nickname }}</h2>
                                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" class="mx-auto text-slate-400" viewBox="0 0 24 24" fill="currentColor">
                                    <path fill-rule="evenodd"
                                        d="M5.166 2.621v.858c-1.035.148-2.059.33-3.071.543a.75.75 0 0 0-.584.859 6.753 6.753 0 0 0 6.138 5.6 6.73 6.73 0 0 0 2.743 1.346A6.707 6.707 0 0 1 9.279 15H8.54c-1.036 0-1.875.84-1.875 1.875V19.5h-.75a2.25 2.25 0 0 0-2.25 2.25c0 .414.336.75.75.75h15a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-2.25-2.25h-.75v-2.625c0-1.036-.84-1.875-1.875-1.875h-.739a6.706 6.706 0 0 1-1.112-3.173 6.73 6.73 0 0 0 2.743-1.347 6.753 6.753 0 0 0 6.139-5.6.75.75 0 0 0-.585-.858 47.077 47.077 0 0 0-3.07-.543V2.62a.75.75 0 0 0-.658-.744 49.22 49.22 0 0 0-6.093-.377c-2.063 0-4.096.128-6.093.377a.75.75 0 0 0-.657.744Zm0 2.629c0 1.196.312 2.32.857 3.294–ê5.266 5.266 0 0 1 3.16 5.337..."
                                        clip-rule="evenodd" />
                                </svg>
                                <span class="font-bold text-slate-500">
                                    {{ top3.1.score }} “±–ø–∞–π ¬∑ {{ top3.1.correct_count }} –¥“±—Ä—ã—Å
                                </span>
                            </div>
                        {% else %}
                            <div class="w-full h-full flex justify-center items-center">
                                <div class="grid gap-2 text-muted">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" class="mx-auto text-secondary-300" viewBox="0 0 24 24" fill="currentColor" class="mx-auto">
                                        <path fill-rule="evenodd"
                                            d="M5.166 2.621v.858c-1.035.148-2.059.33-3.071.543a.75.75 0 0 0-.584.859 6.753 6.753 0 0 0 6.138 5.6 6.73 6.73 0 0 0 2.743 1.346A6.707 6.707 0 0 1 9.279 15H8.54c-1.036 0-1.875.84-1.875 1.875V19.5h-.75a2.25 2.25 0 0 0-2.25 2.25c0 .414.336.75.75.75h15a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-2.25-2.25h-.75v-2.625c0-1.036-.84-1.875-1.875-1.875h-.739a6.706 6.706 0 0 1-1.112-3.173 6.73 6.73 0 0 0 2.743-1.347 6.753 6.753 0 0 0 6.139-5.6.75.75 0 0 0-.585-.858 47.077 47.077 0 0 0-3.07-.543V2.62a.75.75 0 0 0-.658-.744 49.22 49.22 0 0 0-6.093-.377c-2.063 0-4.096.128-6.093.377a.75.75 0 0 0-.657.744Zm0 2.629c0 1.196.312 2.32.857 3.294–ê5.266 5.266 0 0 1 3.16 5.337..."
                                            clip-rule="evenodd" />
                                    </svg>
                                    <div>2-–æ—Ä—ã–Ω ”ô–ª—ñ –±–æ—Å</div>
                                </div>
                            </div>
                        {% endif %}
                    </div>

                    <!-- 3-–æ—Ä—ã–Ω. –û“£ –∂–∞“õ -->
                    <div class="sm:order-3 space-y-2 border border-border-200 rounded-xl text-center p-8 translate-y-4">
                        {% if top3|length > 2 %}
                            <div class="
                                w-20 h-20 mx-auto flex justify-center items-center rounded-full border-4 border-primary-100 bg-primary-50 
                                text-primary-700 text-3xl font-black
                            ">
                                {{ top3.2.nickname|first|upper }}
                            </div>
                            <div class="space-y-2">
                                <h2 class="text-lg md:text-xl font-black">{{ top3.2.nickname }}</h2>
                                <span class="text-sm font-medium text-slate-600">
                                    {{ top3.2.score }} “±–ø–∞–π ¬∑ {{ top3.2.correct_count }} –¥“±—Ä—ã—Å
                                </span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" class="text-amber-800" viewBox="0 0 24 24" fill="currentColor" class="mx-auto">
                                    <path fill-rule="evenodd"
                                        d="M5.166 2.621v.858c-1.035.148-2.059.33-3.071.543a.75.75 0 0 0-.584.859 6.753 6.753 0 0 0 6.138 5.6 6.73 6.73 0 0 0 2.743 1.346A6.707 6.707 0 0 1 9.279 15H8.54c-1.036 0-1.875.84-1.875 1.875V19.5h-.75a2.25 2.25 0 0 0-2.25 2.25c0 .414.336.75.75.75h15a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-2.25-2.25h-.75v-2.625c0-1.036-.84-1.875-1.875-1.875h-.739a6.706 6.706 0 0 1-1.112-3.173 6.73 6.73 0 0 0 2.743-1.347 6.753 6.753 0 0 0 6.139-5.6.75.75 0 0 0-.585-.858 47.077 47.077 0 0 0-3.07-.543V2.62a.75.75 0 0 0-.658-.744 49.22 49.22 0 0 0-6.093-.377c-2.063 0-4.096.128-6.093.377a.75.75 0 0 0-.657.744Zm0 2.629c0 1.196.312 2.32.857 3.294–ê5.266 5.266 0 0 1 3.16 5.337..."
                                        clip-rule="evenodd" 
                                    />
                                </svg>
                            </div>
                        {% else %}
                            <div class="w-full h-full flex justify-center items-center">
                                <div class="grid gap-2 text-muted">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" class="mx-auto text-secondary-300" viewBox="0 0 24 24" fill="currentColor" class="mx-auto">
                                        <path fill-rule="evenodd"
                                            d="M5.166 2.621v.858c-1.035.148-2.059.33-3.071.543a.75.75 0 0 0-.584.859 6.753 6.753 0 0 0 6.138 5.6 6.73 6.73 0 0 0 2.743 1.346A6.707 6.707 0 0 1 9.279 15H8.54c-1.036 0-1.875.84-1.875 1.875V19.5h-.75a2.25 2.25 0 0 0-2.25 2.25c0 .414.336.75.75.75h15a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-2.25-2.25h-.75v-2.625c0-1.036-.84-1.875-1.875-1.875h-.739a6.706 6.706 0 0 1-1.112-3.173 6.73 6.73 0 0 0 2.743-1.347 6.753 6.753 0 0 0 6.139-5.6.75.75 0 0 0-.585-.858 47.077 47.077 0 0 0-3.07-.543V2.62a.75.75 0 0 0-.658-.744 49.22 49.22 0 0 0-6.093-.377c-2.063 0-4.096.128-6.093.377a.75.75 0 0 0-.657.744Zm0 2.629c0 1.196.312 2.32.857 3.294–ê5.266 5.266 0 0 1 3.16 5.337..."
                                            clip-rule="evenodd" />
                                    </svg>
                                    <div>3-–æ—Ä—ã–Ω ”ô–ª—ñ –±–æ—Å</div>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>              
            </div>
        {% else %}
            <p class="text-center text-muted py-8">
                “ö–∞—Ç—ã—Å—É—à—ã–ª–∞—Ä “õ–æ—Å—ã–ª“ì–∞–Ω –∂–æ“õ.
            </p>
        {% endif %}
    {% endwith %}

    <!-- –¢–æ–ª—ã“õ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="overflow-x-auto rounded-2xl border border-border-200 bg-white">
        <table class="min-w-full">
            <thead class="bg-secondary-50">
                <tr class="border-b border-border-200 tracking-wide">
                    <th class="px-4 py-3 text-left w-10">#</th>
                    <th class="px-4 py-3 text-left">“ö–∞—Ç—ã—Å—É—à—ã</th>
                    <th class="px-4 py-3 text-center">“∞–ø–∞–π</th>
                    <th class="px-4 py-3 text-center">–î“±—Ä—ã—Å</th>
                    <th class="px-4 py-3 text-right">–°—Ç–∞—Ç—É—Å</th>
                </tr>
            </thead>

            <tbody class="divide-y divide-border-100">
                {% if participants %}
                    {% for p in participants %}
                        <tr class="transition hover:bg-primary-50/50">
                            <!-- POSITION -->
                            <td class="px-4 py-2 font-semibold text-slate-500">
                                {% if forloop.counter == 1 %}
                                    ü•á
                                {% elif forloop.counter == 2 %}
                                    ü•à
                                {% elif forloop.counter == 3 %}
                                    ü•â
                                {% else %}
                                    {{ forloop.counter }}
                                {% endif %}
                            </td>

                            <!-- PARTICIPANT -->
                            <td class="px-4 py-2">
                                <div class="flex items-center gap-3">
                                    <div class="h-8 w-8 flex items-center justify-center rounded-full font-bold bg-primary-600 text-white border-2 border-primary-300">
                                        {{ p.nickname|first|upper }}
                                    </div>
                                    <div>
                                        <p class="font-bold leading-tight">
                                            {{ p.nickname }}
                                        </p>
                                        {% if p.started_at %}
                                            <p class="text-xs text-slate-400">
                                                –∫—ñ—Ä–¥—ñ: {{ p.started_at|time:"H:i:s" }}
                                            </p>
                                        {% endif %}
                                    </div>
                                </div>
                            </td>

                            <!-- SCORE -->
                            <td class="px-4 py-2 text-center font-bold">
                                {{ p.score }}
                            </td>

                            <!-- CORRECT -->
                            <td class="px-4 py-2 text-center text-muted">
                                {{ p.correct_count }}/{{ game_task.questions.count }}
                            </td>

                            <!-- STATUS -->
                            <td class="px-4 py-3 text-right">
                                {% if p.is_finished %}
                                    <span class="inline-flex items-center gap-1 rounded-full bg-emerald-100 px-2 py-1 text-xs font-medium text-emerald-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                            <path fill-rule="evenodd"
                                                d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z"
                                                clip-rule="evenodd" />
                                        </svg>

                                        –ê—è“õ—Ç–∞–¥—ã
                                    </span>
                                {% else %}
                                    <span class="inline-flex items-center gap-1 rounded-full bg-blue-100 px-2 py-1 text-xs font-medium text-blue-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                            class="lucide lucide-circle-dashed-icon lucide-circle-dashed">
                                            <path d="M10.1 2.182a10 10 0 0 1 3.8 0" />
                                            <path d="M13.9 21.818a10 10 0 0 1-3.8 0" />
                                            <path d="M17.609 3.721a10 10 0 0 1 2.69 2.7" />
                                            <path d="M2.182 13.9a10 10 0 0 1 0-3.8" />
                                            <path d="M20.279 17.609a10 10 0 0 1-2.7 2.69" />
                                            <path d="M21.818 10.1a10 10 0 0 1 0 3.8" />
                                            <path d="M3.721 6.391a10 10 0 0 1 2.7-2.69" />
                                            <path d="M6.391 20.279a10 10 0 0 1-2.69-2.7" />
                                        </svg>
                                        <span>”®—Ç—ñ–ø –∂–∞—Ç—ã—Ä</span>
                                    </span>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="5" class="px-4 py-12 text-center text-muted">
                            “ö–∞—Ç—ã—Å—É—à—ã–ª–∞—Ä “õ–æ—Å—ã–ª“ì–∞–Ω –∂–æ“õ.
                        </td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>
