{# 1) Сұрақ мәтіні #}
<h2 class="text-lg font-semibold text-slate-900 mb-4">
    {{ question.body|safe }}
</h2>

{# 2) Прогресс #}
<p class="mb-3 text-xs text-slate-500 text-right">
    Сұрақ {{ index }} / {{ total_questions }}
</p>

{# 3) Жауап беру формасы #}
<form
    method="post"
    action="{% url 'main:gameplay_answer' participant.token %}"
    hx-post="{% url 'main:gameplay_answer' participant.token %}"
    hx-target="#question-container"
    hx-swap="innerHTML"
    class="space-y-3"
>
    {% csrf_token %}

    {% with q_format=question.format.code v_code=question.variant.code|default_if_none:"" %}
        
        {% if q_format == "test" %}
            {% if options %}
                {# Multiple choice #}
                {% if v_code == "multiple" %}
                    {% for opt in options %}
                        <label class="flex items-start gap-2 border border-border-200 rounded-xl px-3 py-2 cursor-pointer hover:bg-slate-50">
                            <input
                                type="checkbox"
                                name="options"
                                value="{{ opt.id }}"
                                class="mt-1"
                            >
                            <span class="text-sm text-slate-800">
                                {{ opt.answer|safe }}
                            </span>
                        </label>
                    {% endfor %}

                {# Single choice #}
                {% else %}
                    {% for opt in options %}
                        <label class="flex items-start gap-2 border border-border-200 rounded-xl px-3 py-2 cursor-pointer hover:bg-slate-50">
                            <input
                                type="radio"
                                name="options"
                                value="{{ opt.id }}"
                                class="mt-1"
                            >
                            <span class="text-sm text-slate-800">
                                {{ opt.answer|safe }}
                            </span>
                        </label>
                    {% endfor %}
                {% endif %}

            {% else %}
                <p class="text-sm text-slate-500">Бұл тест сұраққа жауап нұсқалары анықталмаған.</p>
            {% endif %}

        {% elif q_format == "open" %}
            <textarea
                name="answer"
                rows="3"
                class="w-full border border-border-200 rounded-xl px-3 py-2 text-sm focus:ring-2 focus:ring-primary-600"
                placeholder="Жауабыңызды жазыңыз..."
            ></textarea>

        {% else %}
            <p class="text-sm text-slate-500">
                Бұл форматтағы сұрақ әзірге конфигурацияланбаған ({{ q_format }}).
            </p>
        {% endif %}

    {% endwith %}

    <button
        type="submit"
        class="w-full mt-4 rounded-xl bg-primary-600 text-white py-2.5 text-sm font-medium hover:bg-primary-700 active:scale-95 transition"
    >
        Жауап беру
    </button>
</form>